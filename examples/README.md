# Test Data Schemas

This directory contains example schema files for testing and development with AChemDB.

## Available Schemas

### `schema.json` (Default)

A simple default schema with basic event processing. Used by default in `docker-compose.yml`.

**Species:**

- `Event` - Raw system events
- `Processed` - Processed events
- `Alert` - System alerts

**Use Case:** General purpose testing and development

### `schema_security.json`

Security monitoring and alerting system.

**Species:**

- `Event` - Raw security/ops events
- `Suspicion` - Suspicious entities (IP/user/etc.)
- `Alert` - Alerts generated by the system

**Use Case:** Security event processing, intrusion detection, anomaly detection

### `schema_ecommerce.json`

E-commerce system for tracking user behavior and purchases.

**Species:**

- `PageView` - User page view events
- `CartItem` - Items added to shopping cart
- `Purchase` - Completed purchases
- `Recommendation` - Product recommendations
- `AbandonedCart` - Abandoned shopping carts

**Use Case:** E-commerce analytics, recommendation systems, cart abandonment tracking

### `schema_monitoring.json`

System monitoring and metrics processing.

**Species:**

- `Metric` - Raw metrics from systems
- `Anomaly` - Detected anomalies
- `Incident` - Incidents requiring attention
- `Baseline` - Baseline metric values

**Use Case:** Infrastructure monitoring, anomaly detection, incident management

### `schema_iot.json`

IoT device monitoring and maintenance system.

**Species:**

- `SensorReading` - Raw sensor readings from IoT devices
- `Threshold` - Threshold values for sensors
- `Alert` - Alerts triggered by sensor readings
- `DeviceStatus` - Device health status
- `Maintenance` - Maintenance requests

**Use Case:** IoT device management, sensor monitoring, predictive maintenance

## Using Different Schemas

### With Docker Compose

To use a different schema, update the volume mount in `docker-compose.yml`:

```yaml
volumes:
  - ./examples/schema_security.json:/config/schema.json:ro
```

Or create a `docker-compose.override.yml`:

```yaml
version: "3.9"

services:
  achemdb:
    volumes:
      - ./examples/schema_ecommerce.json:/config/schema.json:ro
```

### With Docker Run

```bash
docker run -p 8080:8080 \
  -v $(pwd)/test-data/schema_security.json:/config/schema.json:ro \
  -e ACHEMDB_SCHEMA_FILE=/config/schema.json \
  kaelisra/achemdb:latest
```

## Schema Format

All schemas follow the AChemDB schema format:

```json
{
  "name": "schema-name",
  "species": [
    {
      "name": "SpeciesName",
      "description": "Description of the species"
    }
  ],
  "reactions": [
    {
      "id": "reaction_id",
      "name": "Human readable name",
      "input": { ... },
      "rate": 0.8,
      "effects": [ ... ]
    }
  ]
}
```

See the [DSL Reference](../docs/dsl.md) for complete documentation on schema structure.

## Design Principles

These example schemas demonstrate common AChemDB patterns while avoiding infinite proliferation:

### Decay and Expiry

Temporary molecules (e.g., `CartItem`, `SensorReading`, `Anomaly`, `Alert`) use decay reactions that reduce energy over time. When energy reaches zero, the molecule is consumed, preventing unbounded accumulation.

### Guard Conditions

Reactions that promote low-level signals to higher-level entities (e.g., `Anomaly` → `Incident`, `Alert` → `Maintenance`) use `count_molecules` conditions to ensure:

- **Uniqueness**: Only one high-level entity is created per unique key (e.g., one `Incident` per `metric_name`)
- **Thresholds**: Higher-level entities are only created when sufficient low-level signals exist (e.g., 3+ anomalies trigger an incident)
- **Rate limiting**: Prevent creating duplicate recommendations, alerts, or incidents on every tick

### Consumption Patterns

Reactions that transform molecules typically consume the input molecule to prevent infinite replication. For example, `Event` → `Processed` consumes the original `Event`.

These patterns ensure that example schemas remain stable and don't create unbounded molecule populations during simulation.

## Simulation Tool

You can test these schemas using the `achemdb-sim` CLI tool. See the [Simulation Documentation](../docs/simulations.md) for details.

Example:

```bash
go run ./cmd/achemdb-sim \
  --schema-file=examples/schema_security.json \
  --ticks=200 \
  --seed=examples/seeds_security.json
```

## Automated Testing

These example schemas are covered by automated tests in `internal/achem/simulation_test.go`. The tests ensure:

- Schemas don't create unbounded molecule populations
- Decay reactions work correctly
- Higher-level species appear as expected
- No runaway reactions occur

Run the tests:

```bash
go test ./internal/achem -v -run TestSimulation
```
